#include "utilities_file.h"

///==================================================================================================================================================================================
///	Подключение стандартных библиотек и макросов
///==================================================================================================================================================================================
#include <cstdio>
#include <fstream>

///==================================================================================================================================================================================
///	Подключение сторонних библиотек и макросов
///==================================================================================================================================================================================
#include "return.h"

#ifndef WINDOWS_COMPILER
	#define fopen_s(pFile,filename,mode) ((*(pFile))=fopen((filename),  (mode)))==NULL
#endif

///==================================================================================================================================================================================
///	Информация о файлах
///==================================================================================================================================================================================

bool FileExist(const char *fname)
//==============================================================================================================================================
//	Функция:	FileExist(const char *fname)
//==============================================================================================================================================
//	Функция проверяет наличие файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	fname	-	Имя файла
//==============================================================================================================================================
//	Возвращаемое значение функции:	TRU - файл существует; FALSE - Файл не существует
//==============================================================================================================================================
//	Дата: 02.02.2018
//==============================================================================================================================================
//	Последнее обновление:	02.02.2018	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "FILE EXIST:";


	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(fname);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (Infield.good());
}

bool FileExist(std::string fname)
//==============================================================================================================================================
//	Функция:	FileExist(std::string fname)
//==============================================================================================================================================
//	Функция проверяет наличие файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	fname	-	Имя файла
//==============================================================================================================================================
//	Возвращаемое значение функции:	TRU - файл существует; FALSE - Файл не существует
//==============================================================================================================================================
//	Дата: 02.02.2018
//==============================================================================================================================================
//	Последнее обновление:	02.02.2018	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "FILE EXIST:";


	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(fname.c_str());

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (Infield.good());
}

long FileSize(const char *FileName)
//==============================================================================================================================================
//	Функция:	FileSize(const char *FileName)
//==============================================================================================================================================
//	Функция получает размер файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	FileName	-	Имя файла
//==============================================================================================================================================
//	Возвращаемое значение функции:	-1: Ошибка; Положительное число - размер файла;
//==============================================================================================================================================
//	Дата: 19.03.2019
//==============================================================================================================================================
//	Последнее обновление:	19.03.2019	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "FILE SIZE:";

	int Error = RETURN_OK;
	long Size = RETURN_OK;
	FILE *File = NULL;


	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(FileName);
	if (Infield.good() == false) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Открытие файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	Error = fopen_s(&File, FileName, "r");
	if (Error == RETURN_OK) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Получение размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	fseek(File, 0, SEEK_END);
	Size = ftell(File);
	fclose(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (long)(Size);
}

long FileSize(std::string FileName)
//==============================================================================================================================================
//	Функция:	FileSize(std::string FileName)
//==============================================================================================================================================
//	Функция получает размер файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	FileName	-	Имя файла
//==============================================================================================================================================
//	Возвращаемое значение функции:	-1: Ошибка; Положительное число - размер файла;
//==============================================================================================================================================
//	Дата: 19.03.2019
//==============================================================================================================================================
//	Последнее обновление:	19.03.2019	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "FILE SIZE:";

	int Error = RETURN_OK;
	long Size = RETURN_OK;
	FILE *File = NULL;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(FileName.c_str());
	if (Infield.good() == false) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Открытие файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	Error = fopen_s(&File, FileName.c_str(), "r");
	if (Error == RETURN_OK) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Получение размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	fseek(File, 0, SEEK_END);
	Size = ftell(File);
	fclose(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (long)(Size);
}

///==================================================================================================================================================================================
///	Чтение из файла
///==================================================================================================================================================================================

long MessageFromFile(const char *FileName, char *Message, long Size)
//==============================================================================================================================================
//	Функция:	MessageFromFile(const char *FileName, char *Message, long Size)
//==============================================================================================================================================
//	Функция считывает текстовый массив из файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	FileName	-	Имя файла
//	Message		-	Считываемый массив
//	Size		-	Размер массива
//==============================================================================================================================================
//	Возвращаемое значение функции:	-1: ошибка программы; Положительное число - Количество прочитанных байт;
//==============================================================================================================================================
//	Дата: 07.04.2021
//==============================================================================================================================================
//	Последнее обновление:	07.04.2021	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "MESSAGE FROM FILE:";

	int Error = RETURN_OK;
	long lSize = RETURN_OK;
	FILE *File = NULL;


	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(FileName);
	if (Infield.good() == false) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Открытие файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	Error = fopen_s(&File, FileName, "r");
	if (Error == RETURN_OK) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Получение размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	fseek(File, 0, SEEK_END);
	lSize = ftell(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	if (lSize > Size) lSize = Size;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Чтение данныx из файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	rewind(File);
	size_t result = fread(Message, 1, lSize, File);
	fclose(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (long)result;
}

long MessageFromFile(std::string FileName, char *Message, long Size)
//==============================================================================================================================================
//	Функция:	MessageFromFile(std::string FileName, char *Message, long Size)
//==============================================================================================================================================
//	Функция считывает текстовый массив из файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	FileName	-	Имя файла
//	Message		-	Считываемый массив
//	Size		-	Размер массива
//==============================================================================================================================================
//	Возвращаемое значение функции:	-1: ошибка программы; Положительное число - Количество прочитанных байт;
//==============================================================================================================================================
//	Дата: 22.03.2019
//==============================================================================================================================================
//	Последнее обновление:	22.03.2019	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "MESSAGE FROM FILE:";

	int Error = RETURN_OK;
	long lSize = RETURN_OK;
	FILE *File = NULL;


	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(FileName.c_str());
	if (Infield.good() == false) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Открытие файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	Error = fopen_s(&File, FileName.c_str(), "r");
	if (Error == RETURN_OK) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Получение размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	fseek(File, 0, SEEK_END);
	lSize = ftell(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	if (lSize > Size) lSize = Size;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Чтение данныx из файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	rewind(File);
	size_t result = fread(Message, 1, lSize, File);
	fclose(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (long)result;
}

long MessageFromFile(const char *FileName, std::string &Message)
//==============================================================================================================================================
//	Функция:	MessageFromFile(const char *FileName, std::string &Message)
//==============================================================================================================================================
//	Функция считывает текстовый массив из файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	FileName	-	Имя файла
//	Message		-	Считываемый массив
//	Size		-	Размер массива
//==============================================================================================================================================
//	Возвращаемое значение функции:	-1: ошибка программы; Положительное число - Количество прочитанных байт;
//==============================================================================================================================================
//	Дата: 22.03.2019
//==============================================================================================================================================
//	Последнее обновление:	22.03.2019	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "MESSAGE FROM FILE:";

	int Error = RETURN_OK;
	char Ch = 0;
	size_t Size = RETURN_OK;
	FILE *File = NULL;


	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(FileName);
	if (Infield.good() == false) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Открытие файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	Error = fopen_s(&File, FileName, "r");
	if (Error == RETURN_OK) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Получение размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	fseek(File, 0, SEEK_END);
	Size = ftell(File);
	Message = "";

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Чтение данныx из файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	rewind(File);
	while ((Ch = char(fgetc(File))) != EOF) {
		Message += char(Ch); }
	fclose(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (long)Size;
}

long MessageFromFile(std::string FileName, std::string &Message)
//==============================================================================================================================================
//	Функция:	MessageFromFile(string FileName, string &Message)
//==============================================================================================================================================
//	Функция считывает текстовый массив из файла
//==============================================================================================================================================
//  Переменные:
//----------------------------------------------------------------------------------------------------------------------------------------------
//	FileName	-	Имя файла
//	Message		-	Считываемый массив
//	Size		-	Размер массива
//==============================================================================================================================================
//	Возвращаемое значение функции:	-1: ошибка программы; Положительное число - Количество прочитанных байт;
//==============================================================================================================================================
//	Дата: 22.03.2019
//==============================================================================================================================================
//	Последнее обновление:	22.03.2019	|
//==============================================================================================================================================
{
	std::string PROGRAM_NAME = "MESSAGE FROM FILE:";

	int Error = RETURN_OK;
	char Ch = 0;
	size_t Size = RETURN_OK;
	FILE *File = NULL;


	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Проверка наличия файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	std::ifstream Infield(FileName.c_str());
	if (Infield.good() == false) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Открытие файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	Error = fopen_s(&File, FileName.c_str(), "r");
	if (Error == RETURN_OK) return RETURN_ERROR;

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Получение размера файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	fseek(File, 0, SEEK_END);
	Size = ftell(File);
	Message = "";

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Чтение данныx из файла
	//------------------------------------------------------------------------------------------------------------------------------------------
	rewind(File);
	while ((Ch = char(fgetc(File))) != EOF) {
		Message += char(Ch);
	}
	fclose(File);

	//------------------------------------------------------------------------------------------------------------------------------------------
	//	Выход из программы
	//------------------------------------------------------------------------------------------------------------------------------------------
	return (long)Size;
}


///==================================================================================================================================================================================
///	Конец файла
///==================================================================================================================================================================================
